# Python FastAPI Backend

This is the Python FastAPI backend service for the Water Treatment Prediction application.

## Features

- **FastAPI** web framework with automatic API documentation
- **Pydantic** models for request/response validation
- **Ensemble ML predictions** using pre-trained models
- **Feature engineering** pipeline
- **CORS support** for cross-origin requests
- **Health checks** and monitoring
- **Comprehensive error handling**

## Setup

### Local Development

1. **Create virtual environment:**
```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

2. **Install dependencies:**
```bash
pip install -r requirements.txt
```

3. **Ensure models are available:**
Place your `.pkl` model files in the `../models/` directory:
- `water_treatment_turbidity_model.pkl`
- `water_treatment_colour_model.pkl`
- `water_treatment_ph_model.pkl`

4. **Run the server:**
```bash
python main.py
```

The API will be available at `http://localhost:8000`

### Docker

```bash
# Build the image
docker build -t water-treatment-python-api .

# Run the container
docker run -p 8000:8000 -v /path/to/models:/app/models water-treatment-python-api
```

## API Endpoints

### `GET /health`
Health check endpoint that returns service status and loaded models.

### `POST /predict`
Main prediction endpoint that accepts water treatment parameters and returns predictions.

**Request Body:**
```json
{
  "Raw_Turbidity": 25.0,
  "Raw_PH": 7.2,
  "Raw_Colour": 45.0,
  "PAC": 8.5,
  "KMnO4": 2.1,
  "ACD": 1.5
}
```

**Response:**
```json
{
  "success": true,
  "predictions": {
    "turbidity": 2.500,
    "colour": 8.200,
    "ph": 7.100
  },
  "input_data": {
    "Raw_Turbidity": 25.0,
    "Raw_PH": 7.2,
    "Raw_Colour": 45.0,
    "PAC": 8.5,
    "KMnO4": 2.1,
    "ACD": 1.5
  },
  "model_info": {
    "turbidity": {
      "models_used": ["xgb", "ada", "rf"],
      "feature_count": 15
    }
  },
  "timestamp": "2025-07-05T12:00:00"
}
```

### `GET /models`
Returns information about loaded models and their features.

### `GET /docs`
Interactive API documentation (Swagger UI) - automatically generated by FastAPI.

### `GET /redoc`
Alternative API documentation (ReDoc).

## Model Requirements

The service expects model files with the following structure:
```python
{
    'models': {dict of trained models},
    'scaler': StandardScaler object,
    'features': [list of feature names],
    'weights': {dict of model weights},
    'target_name': str
}
```

## Input Validation

- **Raw_Turbidity**: Non-negative float
- **Raw_PH**: Float between 0 and 14
- **Raw_Colour**: Non-negative float
- **PAC**: Non-negative float
- **KMnO4**: Non-negative float
- **ACD**: Non-negative float

## Error Handling

The API provides detailed error responses:
- **422 Unprocessable Entity**: Validation errors
- **500 Internal Server Error**: Prediction failures

## Logging

The service logs all requests, predictions, and errors for monitoring and debugging.

## Performance

- **Fast predictions** using efficient ensemble methods
- **Automatic feature engineering** pipeline
- **Optimized model loading** at startup
- **Asynchronous request handling**
